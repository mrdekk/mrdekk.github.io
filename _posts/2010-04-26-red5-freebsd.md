---
layout: post
title: Установка red5 на FreeBSD 8.0
tags:
 - java
 - freebsd
 - red5
---

Считаю что Java у Вас уже установлена. В противном случае – это тема отдельной статьи, которую вскорости может быть напишу. У меня Java установлена тут

``` bash
$ /usr/local/diablo-jdk1.6.0
```

Для сборки сервера red5 нам потребуется Apache Ant, который можно легко поставить из портов:

``` bash
$ cd /usr/ports/devel/apache-ant
$ make install clean
```

Теперь нам нужны исходники red5, чекаутим их с официального сайта примерно следующим образом:

``` bash
$ mkdir /home/red5
$ svn co http://red5.googlecode.com/svn/java/server/trunk /home/red5
```

Теперь соберем его

``` bash
$ cd /home/red5
$ ant
```

Процесс на 2-3 минуты. Должны поставиться всякие там jar, а те которых нет, подкачаться и также поставиться. Создадим рабочую директорию Red5 и перенесем туда только что собраный сервер:

``` bash
$ mkdir /usr/share/red5
$ cp -R /home/red5/dist/* /usr/share/red5
```

На всякий случай:

``` bash
$ chmod 755 /usr/share/red5/red5.sh
```

Исправляем shell:

``` bash
$ ee /usr/share/red5/red5.sh
 /bin/bash -> /bin/sh
```
Делаем пускач:

``` bash
$ touch /usr/local/etc/rc.d/red5.sh
```

``` bash
#!/bin/sh

RED5_DIR=/usr/share/red5
test -x $RED5_DIR/red5.sh || exit 5

case "$1" in
    start)
        cd "$RED5_DIR"
        "$RED5_DIR"/red5.sh &
        sleep 2
        ;;
    stop)
        echo Shutting down Red5
        killall java
        sleep 2
        ;;
    restart)
        $0 stop
        $0 start
        ;;
esac
```

Запускаем Red5 и проверяем открытость портов:

``` bash
$ /usr/local/etc/rc.d/red5.sh start
$ netstat -ant
 ...
 tcp4       0      0 *.5080                 *.*                    LISTEN
 tcp4       0      0 *.1935                 *.*                    LISTEN
 tcp4       0      0 *.51724                *.*                    LISTEN
 tcp4       0      0 *.9999                 *.*                    LISTEN
 ...
```

Все гуд. Контрольный выстрел:

``` bash
$ telnet name-server 5080 или http://name-server:5080
```

Вот вроде и все – сервер собран, установлен и запущен (дефолтные настройки). Вам осталось накрутить конфиги Red5 под свои нужды (не забываем после этого сделать /usr/local/etc/rc.d/red5.sh restart).

ЗЫ: Правда надо еще поправить пускач, чтобы он стартовал Red5 при старте системы. Ну это на досуге как-нибудь

### Комментарии

 > mandarin80:
 > 01.02.2011 в 19:42
 > установил, но не запускается, в чем может быть проблема?

----

 > MrDekk:
 > 01.02.2011 в 23:09
 > Добрый день!
 > Проблема может быть во многих вещах. Для того, чтобы я Вам мог подсказать по делу надо бы посмотреть логи.

----

 > Тайланд:
 > 03.03.2011 в 00:05
 > У меня проблема в том, что red зависает, проблема решается только перезагрузкой, удалением файла red5.pid и запуском заново, что за фигня, кто знает?

----

 > MrDekk:
 > 03.03.2011 в 18:14
 > Ну, вообще, выключать его правильно. Там есть скриптик, для Windows вроде stop.bat или shutdown.bat, для Unix: stop.sh или shutdown.sh – я не помню точно как называется. Если же это не помогает, то можно написать свой файлик, или скрипт запуска пополнить функцией анализа наличия pid и либо не делать дальше действий и просто сообщать, либо удалять его и проводить нормальный процесс запуска.
