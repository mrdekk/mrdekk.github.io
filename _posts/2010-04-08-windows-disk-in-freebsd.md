---
layout: post
title:  FreeBSD - подключаем виндовый диск
tags:
 - freebsd
 - windows
 - fat32
 - ntfs
---

Как и обещал продолжаю цикл заметок о замене Windows на FreeBSD на почти серверной машине. Сегодняшняя наша цель – подключить виндовый раздел к фре. Сразу стоит отмести ту мысль, что можно было все перевести на ufs и не мучаться. Тут не все так просто, раздел этот размером 1Тб, с заполнением примерно но 80%. Второго такого винта не нашлось для временного перелива информации, поэтому была поставлена задача запустить его под фрей «как есть».

Проблема первая – непонятно какая на нем файловая система (всмысле FAT32 или NTFS). Создавался этот раздел давно и никто уже не помнит. Проблема решается просто – грузимся с любого виндового LiveCD и каким-нибудь Акронисом смотрим. У меня оказалась NTFS. Рекомендую сделать это заранее, т.к. я потратил определенное время пытаясь смонтировать этот винт как FAT32.

Далее нам надо чтобы ядро у нас поддерживало определенную функциональность. Делаем

``` bash
$ kldstat
```

и смотрим чтобы в выдаче был модуль geom_mbr.ko. Если его нет, делаем следующие вещи

``` bash
$ cd /usr/src/sys/modules/geom
$ make && make obj && make install clean
$ kldload geom_mbr
```

кроме того, идем в /boot/loader.conf и прописываем там автозапуск модуля

``` ini
geom_mbr_load="YES"
```

После этого у нас есть возможность видеть разделы в /dev у меня виндовый раздел был ad12s2s1. Далее так как система у нас NTFS надо надо организовать поддержку NTFS. Для этого воспользуемся fusefs. Идем в /usr/ports, делаем

``` bash
$ cd /usr/ports/
$ make search name=’ntfs’
```

и идем в ту которая от fuse. после этого делаем стандартные

``` bash
$ make install clean
```

После этого надо прописать fusefs в автозагрузку. Для этого в /etc/rc.conf добавляем

``` ini
# fusefs
fusefs_enable=»YES»
```

и запускаем

``` bash
$ /usr/loca/etc/rc.d/fusefs start
```

Монтируем том

``` bash
$ mkdir /d
$ ntfs-3g -o rw,locale=ru_RU.UTF-8 /dev/ad12s2s1 /d
```

Чтобы том автоматически подцеплялся при старте системы добавляем строчку в /etc/rc.conf после fusefs

``` ini
# mount ntfs volume
/usr/local/bin/ntfs-3g -o rw,locale=ru_RU.UTF-8 /dev/ad12s2s1 /d
```

После этого

``` bash
$ shutdown -r now
```

И наслаждаемся. Теперь у нас в фряхе подцеплен виндовый ntfs раздел. Могут быть проблемы с UTF-8 в консоли. Но – это тема следующих статей
